îb
~D:\Projects\DefensePoint\whitesource-testcases-csharp\AlbumViewerVNext\src\AlbumViewerNetCore\Controllers\AccountController.cs
	namespace 	!
AlbumViewerAspNetCore
 
{ 
[ 
	Authorize 
( 
) 
] 
[ 
ServiceFilter 
( 
typeof 
( 
ApiExceptionFilter ,
), -
)- .
]. /
public 

class 
AccountController "
:# $

Controller% /
{ 
public $
ApplicationConfiguration '
Configuration( 5
{6 7
get8 ;
;; <
}= >
private 
AccountRepository !
accountRepo" -
;- .
private 
static 

Dictionary !
<! "
string" (
,( )
DateTime* 2
>2 3
cancelledTokens4 C
=D E
newF I

DictionaryJ T
<T U
stringU [
,[ \
DateTime] e
>e f
(f g
)g h
;h i
public!! 
AccountController!!  
(!!  !
AccountRepository!!! 2
actRepo!!3 :
,!!: ;$
ApplicationConfiguration"" $
configuration""% 2
)""2 3
{## 	
Configuration$$ 
=$$ 
configuration$$ )
;$$) *
accountRepo%% 
=%% 
actRepo%% !
;%%! "
}&& 	
[// 	
AllowAnonymous//	 
]// 
[00 	
HttpPost00	 
]00 
[11 	
Route11	 
(11 
$str11 !
)11! "
]11" #
public22 
async22 
Task22 
<22 
object22  
>22  !
Authenticate22" .
(22. /
[22/ 0
FromBody220 8
]228 9
User22: >
	loginUser22? H
)22H I
{33 	
var44 
user44 
=44 
await44 
accountRepo44 (
.44( )#
AuthenticateAndLoadUser44) @
(44@ A
	loginUser44A J
.44J K
Username44K S
,44S T
	loginUser44U ^
.44^ _
Password44_ g
)44g h
;44h i
if55 
(55 
user55 
==55 
null55 
)55 
throw66 
new66 
ApiException66 &
(66& '
$str66' B
,66B C
$num66D G
)66G H
;66H I
var99 
	UserState99 
=99 
new99 
	UserState99  )
(99) *
)99* +
;99+ ,
	UserState<< 
.<< 
	UserIdInt<< 
=<<  !
user<<" &
.<<& '
Id<<' )
;<<) *
	UserState== 
.== 
Name== 
=== 
user== !
.==! "
Fullname==" *
;==* +
	UserState>> 
.>> 
Email>> 
=>> 
user>> "
.>>" #
Username>># +
;>>+ ,
varBB 
tokenBB 
=BB 
	JwtHelperBB !
.BB! "
GetJwtTokenBB" -
(BB- .
userCC 
.CC 
UsernameCC 
,CC 
ConfigurationDD 
.DD 
JwtTokenDD &
.DD& '

SigningKeyDD' 1
,DD1 2
ConfigurationEE 
.EE 
JwtTokenEE &
.EE& '
IssuerEE' -
,EE- .
ConfigurationFF 
.FF 
JwtTokenFF &
.FF& '
AudienceFF' /
,FF/ 0
TimeSpanGG 
.GG 
FromMinutesGG $
(GG$ %
ConfigurationGG% 2
.GG2 3
JwtTokenGG3 ;
.GG; <
TokenTimeoutMinutesGG< O
)GGO P
,GGP Q
newHH 
[HH 
]HH 
{II 
newJJ 
ClaimJJ 
(JJ 
$strJJ )
,JJ) *
	UserStateJJ+ 4
.JJ4 5
ToStringJJ5 =
(JJ= >
)JJ> ?
)JJ? @
}KK 
)KK 
;KK 
returnMM 
newMM 
{NN 
tokenOO 
=OO 
newOO #
JwtSecurityTokenHandlerOO 3
(OO3 4
)OO4 5
.OO5 6

WriteTokenOO6 @
(OO@ A
tokenOOA F
)OOF G
,OOG H
expiresPP 
=PP 
tokenPP 
.PP  
ValidToPP  '
,PP' (
displayNameQQ 
=QQ 
userQQ "
.QQ" #
FullnameQQ# +
}RR 
;RR 
}SS 	
[VV 	
AllowAnonymousVV	 
]VV 
[WW 	
HttpGetWW	 
]WW 
[XX 	
RouteXX	 
(XX 
$strXX 
)XX 
]XX 
publicYY 
boolYY 
LogoutYY 
(YY 
)YY 
{ZZ 	
if^^ 
(^^ 
User^^ 
.^^ 
Identity^^ 
.^^ 
IsAuthenticated^^ -
)^^- .
ExpireToken__ 
(__ 
)__ 
;__ 
returnaa 
trueaa 
;aa 
}bb 	
[dd 	
HttpGetdd	 
]dd 
[ee 	
Routeee	 
(ee 
$stree $
)ee$ %
]ee% &
publicff 
boolff 
IsAuthenthenticatedff '
(ff' (
)ff( )
{gg 	
ifhh 
(hh 
!hh 
Userhh 
.hh 
Identityhh 
.hh 
IsAuthenticatedhh .
||hh/ 1
IsTokenExpiredhh2 @
(hh@ A
)hhA B
)hhB C
returnii 
falseii 
;ii 
returnkk 
truekk 
;kk 
}ll 	
privateoo 
voidoo 
ExpireTokenoo  
(oo  !
)oo! "
{pp 	
stringqq 
idqq 
=qq 
(qq 
(qq 
ClaimsIdentityqq (
)qq( )
Userqq) -
.qq- .
Identityqq. 6
)qq6 7
.qq7 8
Claimsqq8 >
.qq> ?
FirstOrDefaultqq? M
(qqM N
sqqN O
=>qqP R
sqqS T
.qqT U
TypeqqU Y
==qqZ \
$strqq] b
)qqb c
?qqc d
.qqd e
Valueqqe j
;qqj k
ifrr 
(rr 
idrr 
!=rr 
nullrr 
)rr 
cancelledTokensss 
.ss  
Addss  #
(ss# $
idss$ &
,ss& '
DateTimess( 0
.ss0 1
UtcNowss1 7
.ss7 8

AddMinutesss8 B
(ssB C
AppssC F
.ssF G
ConfigurationssG T
.ssT U
JwtTokenssU ]
.ss] ^
TokenTimeoutMinutesss^ q
)ssq r
)ssr s
;sss t
RemoveExpiredTokensuu 
(uu  
)uu  !
;uu! "
}vv 	
privatexx 
boolxx 
IsTokenExpiredxx #
(xx# $
)xx$ %
{yy 	
stringzz 
idzz 
=zz 
(zz 
(zz 
ClaimsIdentityzz (
)zz( )
Userzz) -
.zz- .
Identityzz. 6
)zz6 7
.zz7 8
Claimszz8 >
.zz> ?
FirstOrDefaultzz? M
(zzM N
szzN O
=>zzP R
szzS T
.zzT U
TypezzU Y
==zzZ \
$strzz] b
)zzb c
?zzc d
.zzd e
Valuezze j
;zzj k
if{{ 
({{ 
cancelledTokens{{ 
.{{  
ContainsKey{{  +
({{+ ,
id{{, .
){{. /
){{/ 0
return|| 
true|| 
;|| 
return~~ 
false~~ 
;~~ 
} 	
private
ÅÅ 
void
ÅÅ !
RemoveExpiredTokens
ÅÅ (
(
ÅÅ( )
)
ÅÅ) *
{
ÇÇ 	
var
ÑÑ 
dt
ÑÑ 
=
ÑÑ 
DateTime
ÑÑ 
.
ÑÑ 
UtcNow
ÑÑ $
.
ÑÑ$ %

AddMinutes
ÑÑ% /
(
ÑÑ/ 0
App
ÑÑ0 3
.
ÑÑ3 4
Configuration
ÑÑ4 A
.
ÑÑA B
JwtToken
ÑÑB J
.
ÑÑJ K!
TokenTimeoutMinutes
ÑÑK ^
)
ÑÑ^ _
;
ÑÑ_ `
var
ÖÖ 
cancelledTokenIds
ÖÖ !
=
ÖÖ" #
cancelledTokens
ÖÖ$ 3
.
ÖÖ3 4
Where
ÖÖ4 9
(
ÖÖ9 :
kv
ÖÖ: <
=>
ÖÖ= ?
kv
ÖÖ@ B
.
ÖÖB C
Value
ÖÖC H
>
ÖÖI J
dt
ÖÖK M
)
ÖÖM N
.
ÖÖN O
Select
ÖÖO U
(
ÖÖU V
kv
ÖÖV X
=>
ÖÖY [
kv
ÖÖ\ ^
.
ÖÖ^ _
Key
ÖÖ_ b
)
ÖÖb c
;
ÖÖc d
foreach
ÜÜ 
(
ÜÜ 
var
ÜÜ 
key
ÜÜ 
in
ÜÜ 
cancelledTokenIds
ÜÜ  1
)
ÜÜ1 2
cancelledTokens
áá 
.
áá  
Remove
áá  &
(
áá& '
key
áá' *
)
áá* +
;
áá+ ,
}
àà 	
[
íí 	
AllowAnonymous
íí	 
]
íí 
[
ìì 	
HttpPost
ìì	 
]
ìì 
[
îî 	
Route
îî	 
(
îî 
$str
îî 
)
îî 
]
îî 
public
ïï 
async
ïï 
Task
ïï 
<
ïï 
bool
ïï 
>
ïï 
Login
ïï  %
(
ïï% &
[
ïï& '
FromBody
ïï' /
]
ïï/ 0
User
ïï1 5
	loginUser
ïï6 ?
)
ïï? @
{
ññ 	
var
óó 
user
óó 
=
óó 
await
óó 
accountRepo
óó (
.
óó( )%
AuthenticateAndLoadUser
óó) @
(
óó@ A
	loginUser
óóA J
.
óóJ K
Username
óóK S
,
óóS T
	loginUser
óóU ^
.
óó^ _
Password
óó_ g
)
óóg h
;
óóh i
if
òò 
(
òò 
user
òò 
==
òò 
null
òò 
)
òò 
throw
ôô 
new
ôô 
ApiException
ôô &
(
ôô& '
$str
ôô' B
,
ôôB C
$num
ôôD G
)
ôôG H
;
ôôH I
var
õõ 
identity
õõ 
=
õõ 
new
õõ 
ClaimsIdentity
õõ -
(
õõ- .*
CookieAuthenticationDefaults
õõ. J
.
õõJ K"
AuthenticationScheme
õõK _
)
õõ_ `
;
õõ` a
identity
úú 
.
úú 
AddClaim
úú 
(
úú 
new
úú !
Claim
úú" '
(
úú' (

ClaimTypes
úú( 2
.
úú2 3
Name
úú3 7
,
úú7 8
user
úú9 =
.
úú= >
Username
úú> F
)
úúF G
)
úúG H
;
úúH I
if
ûû 
(
ûû 
user
ûû 
.
ûû 
Fullname
ûû 
==
ûû  
null
ûû! %
)
ûû% &
user
üü 
.
üü 
Fullname
üü 
=
üü 
string
üü  &
.
üü& '
Empty
üü' ,
;
üü, -
identity
†† 
.
†† 
AddClaim
†† 
(
†† 
new
†† !
Claim
††" '
(
††' (
$str
††( 2
,
††2 3
user
††4 8
.
††8 9
Fullname
††9 A
)
††A B
)
††B C
;
††C D
var
¢¢ 
props
¢¢ 
=
¢¢ 
new
¢¢ &
AuthenticationProperties
¢¢ 4
(
¢¢4 5
)
¢¢5 6
{
££ 

ExpiresUtc
§§ 
=
§§ 
DateTime
§§ %
.
§§% &
UtcNow
§§& ,
.
§§, -
AddHours
§§- 5
(
§§5 6
$num
§§6 7
)
§§7 8
}
•• 
;
•• 
await
ßß 
HttpContext
ßß 
.
ßß 
SignInAsync
ßß )
(
ßß) **
CookieAuthenticationDefaults
ßß* F
.
ßßF G"
AuthenticationScheme
ßßG [
,
ßß[ \
new
®® 
ClaimsPrincipal
®® #
(
®®# $
identity
®®$ ,
)
®®, -
)
®®- .
;
®®. /
return
™™ 
true
™™ 
;
™™ 
}
´´ 	
}
ÆÆ 
}ØØ Ç≤
ÖD:\Projects\DefensePoint\whitesource-testcases-csharp\AlbumViewerVNext\src\AlbumViewerNetCore\Controllers\AlbumViewerApiController.cs
	namespace 	!
AlbumViewerAspNetCore
 
{ 
[ 
ServiceFilter 
( 
typeof 
( 
ApiExceptionFilter ,
), -
)- .
]. /
public 

class $
AlbumViewerApiController )
:* +

Controller, 6
{ 
AlbumViewerContext 
context "
;" #
IServiceProvider 
serviceProvider (
;( )
ArtistRepository 

ArtistRepo #
;# $
AlbumRepository 
	AlbumRepo !
;! "
IConfiguration 
Configuration $
;$ %
private 
ILogger 
< $
AlbumViewerApiController 0
>0 1
Logger2 8
;8 9
private!! 
IWebHostEnvironment!! #

HostingEnv!!$ .
;!!. /
public## $
AlbumViewerApiController## '
(##' (
AlbumViewerContext$$ 
ctx$$ "
,$$" #
IServiceProvider%% 
svcProvider%% (
,%%( )
ArtistRepository&& 

artistRepo&& '
,&&' (
AlbumRepository'' 
	albumRepo'' %
,''% &
IConfiguration(( 
config(( !
,((! "
ILogger)) 
<)) $
AlbumViewerApiController)) ,
>)), -
logger)). 4
,))4 5
IWebHostEnvironment** 
env**  #
)**# $
{++ 	
context,, 
=,, 
ctx,, 
;,, 
serviceProvider-- 
=-- 
svcProvider-- )
;--) *
Configuration.. 
=.. 
config.. "
;.." #
	AlbumRepo00 
=00 
	albumRepo00 !
;00! "

ArtistRepo11 
=11 

artistRepo11 #
;11# $
Logger22 
=22 
logger22 
;22 

HostingEnv44 
=44 
env44 
;44 
}55 	
[:: 	
HttpGet::	 
]:: 
[;; 	
Route;;	 
(;; 
$str;; 
);; 
];; 
public<< 
object<< 
Throw<< 
(<< 
)<< 
{== 	
throw>> 
new>> %
InvalidOperationException>> /
(>>/ 0
$str>>0 P
)>>P Q
;>>Q R
}?? 	
[DD 	
HttpGetDD	 
]DD 
[EE 	
RouteEE	 
(EE 
$strEE 
)EE 
]EE 
publicFF 
asyncFF 
TaskFF 
<FF 
IEnumerableFF %
<FF% &
AlbumFF& +
>FF+ ,
>FF, -
	GetAlbumsFF. 7
(FF7 8
intFF8 ;
pageFF< @
=FFA B
-FFC D
$numFFD E
,FFE F
intFFG J
pageSizeFFK S
=FFT U
$numFFV X
)FFX Y
{GG 	
returnII 
awaitII 
	AlbumRepoII "
.II" #
GetAllAlbumsII# /
(II/ 0
pageII0 4
,II4 5
pageSizeII6 >
)II> ?
;II? @
}JJ 	
[LL 	
HttpGetLL	 
(LL 
$strLL 1
)LL1 2
]LL2 3
publicMM 
AlbumMM !
GetAlbumByTitleUnsafeMM *
(MM* +
stringMM+ 1
titleMM2 7
)MM7 8
{NN 	
varOO 
albumByTitleOO 
=OO 
contextOO &
.OO& '
AlbumsOO' -
.OO- .

FromSqlRawOO. 8
(OO8 9
$strOO9 ^
+OO_ `
titleOOa f
)OOf g
.OOg h
FirstOrDefaultOOh v
(OOv w
)OOw x
;OOx y
returnPP 
albumByTitlePP 
;PP  
}QQ 	
[SS 	
HttpGetSS	 
(SS 
$strSS /
)SS/ 0
]SS0 1
publicTT 
AlbumTT 
GetAlbumByTitleSafeTT (
(TT( )
stringTT) /
titleTT0 5
)TT5 6
{UU 	
varVV 
albumByTitleVV 
=VV 
contextVV &
.VV& '
AlbumsVV' -
.VV- .

FromSqlRawVV. 8
(VV8 9
$strVV9 a
,VVa b
titleVVc h
)VVh i
.VVi j
FirstOrDefaultVVj x
(VVx y
)VVy z
;VVz {
returnWW 
albumByTitleWW 
;WW  
}XX 	
[ZZ 	
HttpPostZZ	 
(ZZ 
$strZZ +
)ZZ+ ,
]ZZ, -
public[[ 
string[[ 
InsertTrackUnsafe[[ '
([[' (
[[[( )
FromBody[[) 1
][[1 2
Track[[3 8
postedTrack[[9 D
)[[D E
{\\ 	
string]] 
insertQuery]] 
=]]  
new]]! $
Track]]% *
(]]* +
)]]+ ,
.]], -
BuildInsertQuery]]- =
(]]= >
postedTrack]]> I
)]]I J
;]]J K
SqlUtil^^ 
sqlUtil^^ 
=^^ 
new^^ !
SqlUtil^^" )
(^^) *
)^^* +
;^^+ ,
sqlUtil__ 
.__ 
CreateCommand__ !
(__! "
insertQuery__" -
)__- .
;__. /
return`` 
$str`` 
;`` 
}aa 	
[cc 	
HttpGetcc	 
(cc 
$strcc %
)cc% &
]cc& '
publicdd 
asyncdd 
Taskdd 
<dd 
Albumdd 
>dd  
GetAlbumdd! )
(dd) *
intdd* -
iddd. 0
)dd0 1
{ee 	
returnff 
awaitff 
	AlbumRepoff "
.ff" #
Loadff# '
(ff' (
idff( *
)ff* +
;ff+ ,
}gg 	
[ii 	
HttpGetii	 
(ii 
$strii 6
)ii6 7
]ii7 8
publicjj 
asyncjj 
Taskjj 
<jj 
Albumjj 
>jj  
GetAlbumByTitlejj! 0
(jj0 1
stringjj1 7
titlejj8 =
)jj= >
{kk 	
returnll 
awaitll 
	AlbumRepoll "
.ll" #
LoadWithRawSqlll# 1
(ll1 2
titlell2 7
)ll7 8
;ll8 9
}mm 	
[oo 	
HttpPostoo	 
(oo 
$stroo )
)oo) *
]oo* +
publicpp 
stringpp 
InsertTrackSafepp %
(pp% &
[pp& '
FromBodypp' /
]pp/ 0
Trackpp1 6
postedTrackpp7 B
)ppB C
{qq 	
SqlUtilrr 
sqlUtilrr 
=rr 
newrr !
SqlUtilrr" )
(rr) *
)rr* +
;rr+ ,
sqlUtilss 
.ss 
InsertTrackSafess #
(ss# $
postedTrackss$ /
)ss/ 0
;ss0 1
returntt 
$strtt 
;tt 
}uu 	
[ww 	
HttpGetww	 
(ww 
$strww .
)ww. /
]ww/ 0
publicxx 
stringxx 
GetAlbumByTitleXssxx (
(xx( )
stringxx) /
titlexx0 5
)xx5 6
{yy 	
returnzz 
titlezz 
;zz 
}{{ 	
[}} 	
HttpPost}}	 
(}} 
$str}} 
)}} 
]}} 
public~~ 
async~~ 
Task~~ 
<~~ 
Album~~ 
>~~  
	SaveAlbum~~! *
(~~* +
[~~+ ,
FromBody~~, 4
]~~4 5
Album~~6 ;
postedAlbum~~< G
)~~G H
{ 	
if
ÇÇ 
(
ÇÇ 
!
ÇÇ 
HttpContext
ÇÇ 
.
ÇÇ 
User
ÇÇ !
.
ÇÇ! "
Identity
ÇÇ" *
.
ÇÇ* +
IsAuthenticated
ÇÇ+ :
)
ÇÇ: ;
throw
ÉÉ 
new
ÉÉ 
ApiException
ÉÉ &
(
ÉÉ& '
$str
ÉÉ' P
,
ÉÉP Q
$num
ÉÉR U
)
ÉÉU V
;
ÉÉV W
if
ÖÖ 
(
ÖÖ 
!
ÖÖ 

ModelState
ÖÖ 
.
ÖÖ 
IsValid
ÖÖ #
)
ÖÖ# $
throw
ÜÜ 
new
ÜÜ 
ApiException
ÜÜ &
(
ÜÜ& '
$str
ÜÜ' >
,
ÜÜ> ?
$num
ÜÜ@ C
)
ÜÜC D
;
ÜÜD E
if
àà 
(
àà 
!
àà 
	AlbumRepo
àà 
.
àà 
Validate
àà #
(
àà# $
postedAlbum
àà$ /
)
àà/ 0
)
àà0 1
throw
ââ 
new
ââ 
ApiException
ââ &
(
ââ& '
	AlbumRepo
ââ' 0
.
ââ0 1
ErrorMessage
ââ1 =
,
ââ= >
$num
ââ? B
,
ââB C
	AlbumRepo
ââD M
.
ââM N
ValidationErrors
ââN ^
)
ââ^ _
;
ââ_ `
var
èè 
album
èè 
=
èè 
await
èè 
	AlbumRepo
èè '
.
èè' (
	SaveAlbum
èè( 1
(
èè1 2
postedAlbum
èè2 =
)
èè= >
;
èè> ?
if
êê 
(
êê 
album
êê 
==
êê 
null
êê 
)
êê 
throw
ëë 
new
ëë 
ApiException
ëë &
(
ëë& '
	AlbumRepo
ëë' 0
.
ëë0 1
ErrorMessage
ëë1 =
,
ëë= >
$num
ëë? B
)
ëëB C
;
ëëC D
return
ìì 
album
ìì 
;
ìì 
}
îî 	
[
ññ 	

HttpDelete
ññ	 
(
ññ 
$str
ññ (
)
ññ( )
]
ññ) *
public
óó 
async
óó 
Task
óó 
<
óó 
bool
óó 
>
óó 
DeleteAlbum
óó  +
(
óó+ ,
int
óó, /
id
óó0 2
)
óó2 3
{
òò 	
if
ôô 
(
ôô 
!
ôô 
HttpContext
ôô 
.
ôô 
User
ôô !
.
ôô! "
Identity
ôô" *
.
ôô* +
IsAuthenticated
ôô+ :
)
ôô: ;
throw
öö 
new
öö 
ApiException
öö &
(
öö& '
$str
öö' P
,
ööP Q
$num
ööR U
)
ööU V
;
ööV W
return
úú 
await
úú 
	AlbumRepo
úú "
.
úú" #
DeleteAlbum
úú# .
(
úú. /
id
úú/ 1
)
úú1 2
;
úú2 3
}
ùù 	
[
†† 	
HttpGet
††	 
]
†† 
public
°° 
async
°° 
Task
°° 
<
°° 
string
°°  
>
°°  !
DeleteAlbumByName
°°" 3
(
°°3 4
string
°°4 :
name
°°; ?
)
°°? @
{
¢¢ 	
if
££ 
(
££ 
!
££ 
HttpContext
££ 
.
££ 
User
££ !
.
££! "
Identity
££" *
.
££* +
IsAuthenticated
££+ :
)
££: ;
throw
§§ 
new
§§ 
ApiException
§§ &
(
§§& '
$str
§§' P
,
§§P Q
$num
§§R U
)
§§U V
;
§§V W
var
¶¶ 
pks
¶¶ 
=
¶¶ 
await
ßß 
context
ßß 
.
ßß 
Albums
ßß $
.
®® 
Where
®® 
(
®® 
alb
®® 
=>
®® !
alb
®®" %
.
®®% &
Title
®®& +
==
®®, .
name
®®/ 3
)
®®3 4
.
©© 
Select
©© 
(
©© 
alb
©© 
=>
©©  "
alb
©©# &
.
©©& '
Id
©©' )
)
©©) *
.
©©* +
ToListAsync
©©+ 6
(
©©6 7
)
©©7 8
;
©©8 9
StringBuilder
´´ 
sb
´´ 
=
´´ 
new
´´ "
StringBuilder
´´# 0
(
´´0 1
)
´´1 2
;
´´2 3
foreach
¨¨ 
(
¨¨ 
int
¨¨ 
pk
¨¨ 
in
¨¨ 
pks
¨¨ "
)
¨¨" #
{
≠≠ 
bool
ÆÆ 
result
ÆÆ 
=
ÆÆ 
await
ÆÆ #
	AlbumRepo
ÆÆ$ -
.
ÆÆ- .
DeleteAlbum
ÆÆ. 9
(
ÆÆ9 :
pk
ÆÆ: <
)
ÆÆ< =
;
ÆÆ= >
if
ØØ 
(
ØØ 
!
ØØ 
result
ØØ 
)
ØØ 
sb
∞∞ 
.
∞∞ 

AppendLine
∞∞ !
(
∞∞! "
	AlbumRepo
∞∞" +
.
∞∞+ ,
ErrorMessage
∞∞, 8
)
∞∞8 9
;
∞∞9 :
}
±± 
return
≥≥ 
sb
≥≥ 
.
≥≥ 
ToString
≥≥ 
(
≥≥ 
)
≥≥  
;
≥≥  !
}
¥¥ 	
[
∫∫ 	
HttpGet
∫∫	 
]
∫∫ 
[
ªª 	
Route
ªª	 
(
ªª 
$str
ªª 
)
ªª 
]
ªª 
public
ºº 
async
ºº 
Task
ºº 
<
ºº 
IEnumerable
ºº %
>
ºº% &

GetArtists
ºº' 1
(
ºº1 2
)
ºº2 3
{
ΩΩ 	
return
ææ 
await
ææ 

ArtistRepo
ææ #
.
ææ# $
GetAllArtists
ææ$ 1
(
ææ1 2
)
ææ2 3
;
ææ3 4
}
øø 	
[
¡¡ 	
HttpGet
¡¡	 
(
¡¡ 
$str
¡¡ &
)
¡¡& '
]
¡¡' (
public
¬¬ 
async
¬¬ 
Task
¬¬ 
<
¬¬ 
object
¬¬  
>
¬¬  !
Artist
¬¬" (
(
¬¬( )
int
¬¬) ,
id
¬¬- /
)
¬¬/ 0
{
√√ 	
var
ƒƒ 
artist
ƒƒ 
=
ƒƒ 
await
ƒƒ 

ArtistRepo
ƒƒ )
.
ƒƒ) *
Load
ƒƒ* .
(
ƒƒ. /
id
ƒƒ/ 1
)
ƒƒ1 2
;
ƒƒ2 3
if
∆∆ 
(
∆∆ 
artist
∆∆ 
==
∆∆ 
null
∆∆ 
)
∆∆ 
throw
«« 
new
«« 
ApiException
«« &
(
««& '
$str
««' ;
,
««; <
$num
««= @
)
««@ A
;
««A B
var
…… 
albums
…… 
=
…… 
await
…… 

ArtistRepo
…… )
.
……) * 
GetAlbumsForArtist
……* <
(
……< =
id
……= ?
)
……? @
;
……@ A
return
ÀÀ 
new
ÀÀ 
ArtistResponse
ÀÀ %
(
ÀÀ% &
)
ÀÀ& '
{
ÃÃ 
Artist
ÕÕ 
=
ÕÕ 
artist
ÕÕ 
,
ÕÕ  
Albums
ŒŒ 
=
ŒŒ 
albums
ŒŒ 
}
œœ 
;
œœ 
}
–– 	
[
““ 	
HttpPost
““	 
(
““ 
$str
““ 
)
““ 
]
““  
public
”” 
async
”” 
Task
”” 
<
”” 
ArtistResponse
”” (
>
””( )

SaveArtist
””* 4
(
””4 5
[
””5 6
FromBody
””6 >
]
””> ?
Artist
””@ F
artist
””G M
)
””M N
{
‘‘ 	
if
’’ 
(
’’ 
!
’’ 
HttpContext
’’ 
.
’’ 
User
’’ !
.
’’! "
Identity
’’" *
.
’’* +
IsAuthenticated
’’+ :
)
’’: ;
throw
÷÷ 
new
÷÷ 
ApiException
÷÷ &
(
÷÷& '
$str
÷÷' P
,
÷÷P Q
$num
÷÷R U
)
÷÷U V
;
÷÷V W
if
ÿÿ 
(
ÿÿ 
!
ÿÿ 

ArtistRepo
ÿÿ 
.
ÿÿ 
Validate
ÿÿ $
(
ÿÿ$ %
artist
ÿÿ% +
)
ÿÿ+ ,
)
ÿÿ, -
throw
ŸŸ 
new
ŸŸ 
ApiException
ŸŸ &
(
ŸŸ& '

ArtistRepo
ŸŸ' 1
.
ŸŸ1 2
ValidationErrors
ŸŸ2 B
.
ŸŸB C
ToString
ŸŸC K
(
ŸŸK L
)
ŸŸL M
,
ŸŸM N
$num
ŸŸO R
,
ŸŸR S

ArtistRepo
ŸŸT ^
.
ŸŸ^ _
ValidationErrors
ŸŸ_ o
)
ŸŸo p
;
ŸŸp q
if
‡‡ 
(
‡‡ 
!
‡‡ 
await
‡‡ 

ArtistRepo
‡‡ !
.
‡‡! "
	SaveAsync
‡‡" +
(
‡‡+ ,
artist
‡‡, 2
)
‡‡2 3
)
‡‡3 4
throw
·· 
new
·· 
ApiException
·· &
(
··& '
$"
··' )%
Unable to save artist. 
··) @
{
··@ A

ArtistRepo
··A K
.
··K L
ErrorMessage
··L X
}
··X Y
"
··Y Z
)
··Z [
;
··[ \
return
„„ 
new
„„ 
ArtistResponse
„„ %
(
„„% &
)
„„& '
{
‰‰ 
Artist
ÂÂ 
=
ÂÂ 
artist
ÂÂ 
,
ÂÂ  
Albums
ÊÊ 
=
ÊÊ 
await
ÊÊ 

ArtistRepo
ÊÊ )
.
ÊÊ) * 
GetAlbumsForArtist
ÊÊ* <
(
ÊÊ< =
artist
ÊÊ= C
.
ÊÊC D
Id
ÊÊD F
)
ÊÊF G
}
ÁÁ 
;
ÁÁ 
}
ËË 	
[
ÍÍ 	
HttpGet
ÍÍ	 
(
ÍÍ 
$str
ÍÍ #
)
ÍÍ# $
]
ÍÍ$ %
public
ÎÎ 
async
ÎÎ 
Task
ÎÎ 
<
ÎÎ 
IEnumerable
ÎÎ %
<
ÎÎ% &
object
ÎÎ& ,
>
ÎÎ, -
>
ÎÎ- .
ArtistLookup
ÎÎ/ ;
(
ÎÎ; <
string
ÎÎ< B
search
ÎÎC I
=
ÎÎJ K
null
ÎÎL P
)
ÎÎP Q
{
ÏÏ 	
if
ÌÌ 
(
ÌÌ 
string
ÌÌ 
.
ÌÌ 
IsNullOrEmpty
ÌÌ $
(
ÌÌ$ %
search
ÌÌ% +
)
ÌÌ+ ,
)
ÌÌ, -
return
ÓÓ 
new
ÓÓ 
List
ÓÓ 
<
ÓÓ  
object
ÓÓ  &
>
ÓÓ& '
(
ÓÓ' (
)
ÓÓ( )
;
ÓÓ) *
var
 
repo
 
=
 
new
 
ArtistRepository
 +
(
+ ,
context
, 3
)
3 4
;
4 5
var
ÒÒ 
term
ÒÒ 
=
ÒÒ 
search
ÒÒ 
.
ÒÒ 
ToLower
ÒÒ %
(
ÒÒ% &
)
ÒÒ& '
;
ÒÒ' (
return
ÚÚ 
await
ÚÚ 
repo
ÚÚ 
.
ÚÚ 
ArtistLookup
ÚÚ *
(
ÚÚ* +
term
ÚÚ+ /
)
ÚÚ/ 0
;
ÚÚ0 1
}
ÛÛ 	
[
ˆˆ 	

HttpDelete
ˆˆ	 
(
ˆˆ 
$str
ˆˆ )
)
ˆˆ) *
]
ˆˆ* +
public
˜˜ 
async
˜˜ 
Task
˜˜ 
<
˜˜ 
bool
˜˜ 
>
˜˜ 
DeleteArtist
˜˜  ,
(
˜˜, -
int
˜˜- 0
id
˜˜1 3
)
˜˜3 4
{
¯¯ 	
if
˘˘ 
(
˘˘ 
!
˘˘ 
HttpContext
˘˘ 
.
˘˘ 
User
˘˘ !
.
˘˘! "
Identity
˘˘" *
.
˘˘* +
IsAuthenticated
˘˘+ :
)
˘˘: ;
throw
˙˙ 
new
˙˙ 
ApiException
˙˙ &
(
˙˙& '
$str
˙˙' P
,
˙˙P Q
$num
˙˙R U
)
˙˙U V
;
˙˙V W
return
¸¸ 
await
¸¸ 

ArtistRepo
¸¸ #
.
¸¸# $
DeleteArtist
¸¸$ 0
(
¸¸0 1
id
¸¸1 3
)
¸¸3 4
;
¸¸4 5
}
˝˝ 	
[
ÇÇ 	
HttpGet
ÇÇ	 
]
ÇÇ 
[
ÉÉ 	
Route
ÉÉ	 
(
ÉÉ 
$str
ÉÉ 
)
ÉÉ  
]
ÉÉ  !
public
ÑÑ 
bool
ÑÑ 

ReloadData
ÑÑ 
(
ÑÑ 
)
ÑÑ  
{
ÖÖ 	
if
ÜÜ 
(
ÜÜ 
!
ÜÜ 
HttpContext
ÜÜ 
.
ÜÜ 
User
ÜÜ !
.
ÜÜ! "
Identity
ÜÜ" *
.
ÜÜ* +
IsAuthenticated
ÜÜ+ :
)
ÜÜ: ;
throw
áá 
new
áá 
ApiException
áá &
(
áá& '
$str
áá' P
,
ááP Q
$num
ááR U
)
ááU V
;
ááV W
string
ââ 
isSqLite
ââ 
=
ââ 
Configuration
ââ +
[
ââ+ ,
$str
ââ, <
]
ââ< =
;
ââ= >
try
ää 
{
ãã 
if
åå 
(
åå 
isSqLite
åå 
!=
åå 
$str
åå  &
)
åå& '
{
çç 
context
èè 
.
èè 
Database
èè $
.
èè$ %
ExecuteSqlRaw
èè% 2
(
èè2 3
$str
èî3 
)
îî 
;
îî 
}
ïï 
else
ññ 
{
óó 
context
ôô 
.
ôô 
Database
ôô $
.
ôô$ %
CloseConnection
ôô% 4
(
ôô4 5
)
ôô5 6
;
ôô6 7
try
õõ 
{
úú 
System
ùù 
.
ùù 
IO
ùù !
.
ùù! "
File
ùù" &
.
ùù& '
Delete
ùù' -
(
ùù- .
Path
ùù. 2
.
ùù2 3
Combine
ùù3 :
(
ùù: ;
	Directory
ùù; D
.
ùùD E!
GetCurrentDirectory
ùùE X
(
ùùX Y
)
ùùY Z
,
ùùZ [
$str
ùù\ t
)
ùùt u
)
ùùu v
;
ùùv w
}
ûû 
catch
üü 
{
†† 
throw
°° 
new
°° !
ApiException
°°" .
(
°°. /
$str
°°/ ]
)
°°] ^
;
°°^ _
}
¢¢ 
}
££ 
}
•• 
catch
¶¶ 
{
¶¶ 
}
¶¶ %
AlbumViewerDataImporter
©© #
.
©©# $
EnsureAlbumData
©©$ 3
(
©©3 4
context
©©4 ;
,
©©; <
Path
™™ 
.
™™ 
Combine
™™ 
(
™™ 

HostingEnv
™™ '
.
™™' (
ContentRootPath
™™( 7
,
™™7 8
$str
´´ 
)
´´ 
)
´´ 
;
´´ 
return
≠≠ 
true
≠≠ 
;
≠≠ 
}
ÆÆ 	
}
≤≤ 
public
∂∂ 

class
∂∂ 
ArtistResponse
∂∂ 
{
∑∑ 
public
∏∏ 
Artist
∏∏ 
Artist
∏∏ 
{
∏∏ 
get
∏∏ "
;
∏∏" #
set
∏∏$ '
;
∏∏' (
}
∏∏) *
public
∫∫ 
List
∫∫ 
<
∫∫ 
Album
∫∫ 
>
∫∫ 
Albums
∫∫ !
{
∫∫" #
get
∫∫$ '
;
∫∫' (
set
∫∫) ,
;
∫∫, -
}
∫∫. /
}
ªª 
}ææ º%
ÑD:\Projects\DefensePoint\whitesource-testcases-csharp\AlbumViewerVNext\src\AlbumViewerNetCore\Controllers\ConfigurationController.cs
	namespace 	
AlbumViewerNetCore
 
. 
Controllers (
{ 
[ 
ServiceFilter 
( 
typeof 
( 
ApiExceptionFilter ,
), -
)- .
]. /
[ 

EnableCors 
( 
$str 
) 
] 
public 

class #
ConfigurationController (
:) *

Controller+ 5
{ 
IOptions 
< $
ApplicationConfiguration )
>) *
AppConfiguration+ ;
;; <
IConfigurationRoot 
RawConfiguration +
;+ ,
IWebHostEnvironment 
Host  
;  !
public #
ConfigurationController &
(& '
IOptions' /
</ 0$
ApplicationConfiguration0 H
>H I
configurationJ W
,W X
IConfigurationRoot 
config %
,% &
IWebHostEnvironment 
host  $
)$ %
{ 	
AppConfiguration   
=   
configuration   ,
;  , -
Host!! 
=!! 
host!! 
;!! 
RawConfiguration"" 
="" 
config"" %
;""% &
}## 	
[&& 	
HttpGet&&	 
]&& 
['' 	
Route''	 
('' 
$str'' "
)''" #
]''# $
public(( $
ApplicationConfiguration(( '
GetConfiguration((( 8
(((8 9
)((9 :
{)) 	
return** 
AppConfiguration** #
.**# $
Value**$ )
;**) *
}++ 	
[.. 
HttpGet.. 
(.. 
$str.. $
)..$ %
]..% &
public// 
object// 
GetApplicationStats// )
(//) *
)//* +
{00 	
var88 
vname88 
=88 
Assembly88  
.88  !
GetEntryAssembly88! 1
(881 2
)882 3
?883 4
.884 5
GetCustomAttribute885 G
<88G H$
TargetFrameworkAttribute88H `
>88` a
(88a b
)88b c
?88c d
.88d e
FrameworkName88e r
;88r s
string:: 
	useSqLite:: 
=:: 
RawConfiguration:: /
[::/ 0
$str::0 @
]::@ A
;::A B
string== 
runtime== 
=== 
System== #
.==# $
Runtime==$ +
.==+ ,
InteropServices==, ;
.==; <
RuntimeInformation==< N
.==N O 
FrameworkDescription==O c
;==c d
var?? 
stats?? 
=?? 
new?? 
{@@ 

OsPlatformAA 
=AA 
SystemAA #
.AA# $
RuntimeAA$ +
.AA+ ,
InteropServicesAA, ;
.AA; <
RuntimeInformationAA< N
.AAN O
OSDescriptionAAO \
,AA\ ]
AspDotnetVersionBB  
=BB! "
vnameBB# (
+BB) *
$strBB+ /
+BB0 1
SystemCC# )
.CC) *
RuntimeCC* 1
.CC1 2
InteropServicesCC2 A
.CCA B
RuntimeInformationCCB T
.CCT U
ProcessArchitectureCCU h
.CCh i
ToStringCCi q
(CCq r
)CCr s
.CCs t
ToLowerCCt {
(CC{ |
)CC| }
+CC~ 
$str
CCÄ É
,
CCÉ Ñ
DataModeDD 
=DD 
	useSqLiteDD $
==DD% '
$strDD( .
?DD/ 0
$strDD1 9
:DD: ;
$strDD< H
}EE 
;EE 
returnGG 
statsGG 
;GG 
}HH 	
[TT 	
HttpGetTT	 
]TT 
[UU 	
RouteUU	 
(UU 
$strUU 0
)UU0 1
]UU1 2
publicVV 
ActionResultVV 
LetsEncryptVV '
(VV' (
stringVV( .
idVV/ 1
)VV1 2
{WW 	
varXX 
fileXX 
=XX 
PathXX 
.XX 
CombineXX #
(XX# $
HostXX$ (
.XX( )
WebRootPathXX) 4
,XX4 5
$strXX6 C
,XXC D
$strXXE U
,XXU V
idXXW Y
)XXY Z
;XXZ [
returnYY 
PhysicalFileYY 
(YY  
fileYY  $
,YY$ %
$strYY& 2
)YY2 3
;YY3 4
}ZZ 	
}[[ 
}\\ 
ÉD:\Projects\DefensePoint\whitesource-testcases-csharp\AlbumViewerVNext\src\AlbumViewerNetCore\Controllers\ErrorHandling\ApiError.cs
	namespace 	!
AlbumViewerAspNetCore
 
{ 
public 

class 
ApiError 
{ 
public 
string 
message 
{ 
get  #
;# $
set% (
;( )
}* +
public 
bool 
isError 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
detail 
{ 
get "
;" #
set$ '
;' (
}) *
public 
object 
data 
{ 
get  
;  !
set" %
;% &
}' (
public %
ValidationErrorCollection (
errors) /
{0 1
get2 5
;5 6
set7 :
;: ;
}< =
public 
ApiError	 
( 
string 
message  
)  !
{ 	
this 
. 
message 
= 
message "
;" #
isError 
= 
true 
; 
} 	
public 
ApiError 
(  
ModelStateDictionary ,

modelState- 7
)7 8
{ 	
this 
. 
isError 
= 
true 
;  
if 
( 

modelState 
!= 
null "
&&# %

modelState& 0
.0 1
Any1 4
(4 5
m5 6
=>7 9
m: ;
.; <
Value< A
.A B
ErrorsB H
.H I
CountI N
>O P
$numQ R
)R S
)S T
{   
message!! 
=!! 
$str!! N
;!!N O
}%% 
}&& 	
}'' 
}(( ì
áD:\Projects\DefensePoint\whitesource-testcases-csharp\AlbumViewerVNext\src\AlbumViewerNetCore\Controllers\ErrorHandling\ApiException.cs
	namespace 	!
AlbumViewerAspNetCore
 
{ 
public 

class 
ApiException 
: 
	Exception  )
{ 
public 
int 

StatusCode 
{ 
get  #
;# $
set% (
;( )
}* +
public %
ValidationErrorCollection (
Errors) /
{0 1
get2 5
;5 6
set7 :
;: ;
}< =
public 
ApiException 
( 
string "
message# *
,* +
int 

statusCode  *
=+ ,
$num- 0
,0 1%
ValidationErrorCollection 5
errors6 <
== >
null? C
)C D
:E F
base 
( 
message 
) 
{ 	

StatusCode 
= 

statusCode #
;# $
Errors 
= 
errors 
; 
} 	
public 
ApiException 
( 
	Exception %
ex& (
,( )
int* -

statusCode. 8
=9 :
$num; >
)> ?
:@ A
baseB F
(F G
exG I
.I J
MessageJ Q
)Q R
{ 	

StatusCode 
= 

statusCode #
;# $
}   	
}!! 
}## ë#
çD:\Projects\DefensePoint\whitesource-testcases-csharp\AlbumViewerVNext\src\AlbumViewerNetCore\Controllers\ErrorHandling\ApiExceptionFilter.cs
	namespace 	!
AlbumViewerAspNetCore
 
{ 
public 

class 
ApiExceptionFilter #
:$ %$
ExceptionFilterAttribute& >
{ 
private 
ILogger 
< 
ApiExceptionFilter *
>* +
_Logger, 3
;3 4
public 
ApiExceptionFilter !
(! "
ILogger" )
<) *
ApiExceptionFilter* <
>< =
logger> D
)D E
{ 	
_Logger 
= 
logger 
; 
} 	
public 
override 
void 
OnException (
(( )
ExceptionContext) 9
context: A
)A B
{ 	
ApiError 
apiError 
= 
null  $
;$ %
if 
( 
context 
. 
	Exception !
is" $
ApiException% 1
)1 2
{ 
var 
ex 
= 
context  
.  !
	Exception! *
as+ -
ApiException. :
;: ;
context 
. 
	Exception !
=" #
null$ (
;( )
apiError 
= 
new 
ApiError '
(' (
ex( *
.* +
Message+ 2
)2 3
;3 4
apiError   
.   
errors   
=    !
ex  " $
.  $ %
Errors  % +
;  + ,
context"" 
."" 
HttpContext"" #
.""# $
Response""$ ,
."", -

StatusCode""- 7
=""8 9
ex"": <
.""< =

StatusCode""= G
;""G H
_Logger$$ 
.$$ 

LogWarning$$ "
($$" #
$"$$# %&
Application thrown error: $$% ?
{$$? @
ex$$@ B
.$$B C
Message$$C J
}$$J K
"$$K L
,$$L M
ex$$N P
)$$P Q
;$$Q R
}%% 
else&& 
if&& 
(&& 
context&& 
.&& 
	Exception&& &
is&&' )'
UnauthorizedAccessException&&* E
)&&E F
{'' 
apiError(( 
=(( 
new(( 
ApiError(( '
(((' (
$str((( =
)((= >
;((> ?
context)) 
.)) 
HttpContext)) #
.))# $
Response))$ ,
.)), -

StatusCode))- 7
=))8 9
$num)): =
;))= >
_Logger** 
.** 

LogWarning** "
(**" #
$str**# N
)**N O
;**O P
}++ 
else,, 
{-- 
var33 
msg33 
=33 
context33 !
.33! "
	Exception33" +
.33+ ,
GetBaseException33, <
(33< =
)33= >
.33> ?
Message33? F
;33F G
string44 
stack44 
=44 
context44 &
.44& '
	Exception44' 0
.440 1

StackTrace441 ;
;44; <
apiError77 
=77 
new77 
ApiError77 '
(77' (
msg77( +
)77+ ,
;77, -
apiError88 
.88 
detail88 
=88  !
stack88" '
;88' (
context:: 
.:: 
HttpContext:: #
.::# $
Response::$ ,
.::, -

StatusCode::- 7
=::8 9
$num::: =
;::= >
_Logger== 
.== 
LogError==  
(==  !
new==! $
EventId==% ,
(==, -
$num==- .
)==. /
,==/ 0
context==1 8
.==8 9
	Exception==9 B
,==B C
msg==D G
)==G H
;==H I
}>> 
contextAA 
.AA 
ResultAA 
=AA 
newAA  

JsonResultAA! +
(AA+ ,
apiErrorAA, 4
)AA4 5
;AA5 6
baseCC 
.CC 
OnExceptionCC 
(CC 
contextCC $
)CC$ %
;CC% &
}DD 	
}EE 
}FF ∫-
çD:\Projects\DefensePoint\whitesource-testcases-csharp\AlbumViewerVNext\src\AlbumViewerNetCore\Controllers\TagHelpers\ErrorDisplayTagHelper.cs
	namespace 	
AlbumViewerAspNet5
 
. 
Controllers (
.( )

TagHelpers) 3
{ 
[ 
HtmlTargetElement 
( 
$str &
)& '
]' (
public 
class !
ErrorDisplayTagHelper "
:# $
	TagHelper% .
{ 
[ 
HtmlAttributeName 
( 
$str  
)  !
]! "
public 

string 
message 
{ 
get 
;  
set! $
;$ %
}& '
[ 
HtmlAttributeName 
( 
$str 
)  
]  !
public 

string 
header 
{ 
get 
; 
set  #
;# $
}% &
[!! 
HtmlAttributeName!! 
(!! 
$str!! 
)!! 
]!! 
public"" 

string"" 
icon"" 
{"" 
get"" 
;"" 
set"" !
;""! "
}""# $
[(( 
HtmlAttributeName(( 
((( 
$str(( 
)(( 
]((  
public)) 

string)) 
cssClass)) 
{)) 
get))  
;))  !
set))" %
;))% &
}))' (
[11 
HtmlAttributeName11 
(11 
$str11 $
)11$ %
]11% &
public22 

string22 

alertClass22 
{22 
get22 "
;22" #
set22$ '
;22' (
}22) *
[99 
HtmlAttributeName99 
(99 
$str99 (
)99( )
]99) *
public:: 

bool:: 
messageAsHtml:: 
{:: 
get::  #
;::# $
set::% (
;::( )
}::* +
[AA 
HtmlAttributeNameAA 
(AA 
$strAA '
)AA' (
]AA( )
publicBB 

boolBB 
headerAsHtmlBB 
{BB 
getBB "
;BB" #
setBB$ '
;BB' (
}BB) *
publicDD 

overrideDD 
voidDD 
ProcessDD  
(DD  !
TagHelperContextDD! 1
contextDD2 9
,DD9 :
TagHelperOutputDD; J
outputDDK Q
)DDQ R
{EE 
ifHH 

(HH 
stringHH 
.HH 
IsNullOrEmptyHH  
(HH  !
messageHH! (
)HH( )
&&HH* ,
stringHH- 3
.HH3 4
IsNullOrEmptyHH4 A
(HHA B
headerHHB H
)HHH I
)HHI J
returnII 
;II 
ifKK 

(KK 
stringKK 
.KK 
IsNullOrEmptyKK  
(KK  !
iconKK! %
)KK% &
)KK& '
iconLL 
=LL 
$strLL 
;LL 
ifMM 

(MM 
iconMM 
==MM 
$strMM 
||MM  
iconMM! %
==MM& (
$strMM) 0
||MM1 3
iconMM4 8
==MM9 ;
$strMM< D
)MMD E
iconNN 
=NN 
iconNN 
+NN 
$strNN "
;NN" #
ifPP 

(PP 
stringPP 
.PP 
IsNullOrEmptyPP  
(PP  !

alertClassPP! +
)PP+ ,
)PP, -

alertClassQQ 
=QQ 
iconQQ 
;QQ 
stringSS 
messageTextSS 
=SS 
!SS 
messageAsHtmlSS +
?SS, -
SystemSS. 4
.SS4 5
NetSS5 8
.SS8 9

WebUtilitySS9 C
.SSC D

HtmlEncodeSSD N
(SSN O
messageSSO V
)SSV W
:SSX Y
messageSSZ a
;SSa b
outputUU 
.UU 
TagNameUU 
=UU 
$strUU 
;UU 
ifXX 

(XX 
cssClassXX 
!=XX 
nullXX 
)XX 
cssClassYY 
=YY 
cssClassYY 
+YY  !
$strYY" 1
+YY2 3

alertClassYY4 >
;YY> ?
elseZZ 
cssClass[[ 
=[[ 
$str[[ %
+[[& '

alertClass[[( 2
;[[2 3
output\\ 
.\\ 

Attributes\\ 
.\\ 
Add\\ 
(\\ 
$str\\ %
,\\% &
cssClass\\' /
)\\/ 0
;\\0 1
if^^ 

(^^ 
string^^ 
.^^ 
IsNullOrEmpty^^  
(^^  !
header^^! '
)^^' (
)^^( )
output__ 
.__ 
Content__ 
.__ 

SetContent__ %
(__% &
$"__& (
<i class='fa fa-__( 8
{__8 9
icon__9 =
}__= >
'></i> __> E
{__E F
messageText__F Q
}__Q R
"__R S
)__S T
;__T U
else`` 
{aa 	
outputbb 
.bb 
Contentbb 
.bb 

SetContentbb %
(bb% &
$"cc  
<h3><i class='fa fa-cc &
{cc& '
iconcc' +
}cc+ ,
'></i> cc, 3
{cc3 4
headercc4 :
}cc: ;
	</h3>\r\ncc; D
"ccD E
+ccF G
$strdd 
+dd 
$"ee 
{ee 
messageTextee 
}ee 
\r\nee #
"ee# $
)ee$ %
;ee% &
}ff 	
}gg 
}hh 
}ii Ë

hD:\Projects\DefensePoint\whitesource-testcases-csharp\AlbumViewerVNext\src\AlbumViewerNetCore\Program.cs
	namespace 	
AlbumViewerNetCore
 
{ 
public 

class 
Program 
{		 
public

 
static

 
void

 
Main

 
(

  
string

  &
[

& '
]

' (
args

) -
)

- .
{ 	
var 
builder 
=  
CreateWebHostBuilder .
(. /
args/ 3
)3 4
;4 5
builder 
. 
Build 
( 
) 
. 
Run 
(  
)  !
;! "
} 	
public 
static 
IWebHostBuilder % 
CreateWebHostBuilder& :
(: ;
string; A
[A B
]B C
argsD H
)H I
{ 	
var 
builder 
= 
WebHost !
.! " 
CreateDefaultBuilder" 6
(6 7
args7 ;
); <
. 

UseStartup 
< 
Startup #
># $
($ %
)% &
;& '
return 
builder 
; 
}!! 	
}$$ 
}%% Ô}
hD:\Projects\DefensePoint\whitesource-testcases-csharp\AlbumViewerVNext\src\AlbumViewerNetCore\Startup.cs
	namespace 	
AlbumViewerNetCore
 
{ 
public 

class 
Startup 
{ 
readonly 
IWebHostEnvironment $
HostingEnvironment% 7
;7 8
IConfigurationRoot 
Configuration (
{) *
get+ .
;. /
}0 1
public 
Startup 
( 
IWebHostEnvironment *
env+ .
). /
{ 	
HostingEnvironment   
=    
env  ! $
;  $ %
var"" 
builder"" 
="" 
new""  
ConfigurationBuilder"" 2
(""2 3
)""3 4
.## 
SetBasePath## 
(## 
env##  
.##  !
ContentRootPath##! 0
)##0 1
.$$ 
AddJsonFile$$ 
($$ 
$str$$ /
,$$/ 0
optional$$1 9
:$$9 :
true$$; ?
,$$? @
reloadOnChange$$A O
:$$O P
true$$Q U
)$$U V
.%% 
AddJsonFile%% 
(%% 
$"%% 
appsettings.%% +
{%%+ ,
env%%, /
.%%/ 0
EnvironmentName%%0 ?
}%%? @
.json%%@ E
"%%E F
,%%F G
optional%%H P
:%%P Q
true%%R V
)%%V W
.&& #
AddEnvironmentVariables&& (
(&&( )
)&&) *
;&&* +
Configuration(( 
=(( 
builder(( #
.((# $
Build(($ )
((() *
)((* +
;((+ ,
})) 	
public-- 
void-- 
ConfigureServices-- %
(--% &
IServiceCollection--& 8
services--9 A
)--A B
{.. 	
services// 
.// 
AddDbContext// !
<//! "
AlbumViewerContext//" 4
>//4 5
(//5 6
builder//6 =
=>//> @
{00 
string11 
	useSqLite11  
=11! "
Configuration11# 0
[110 1
$str111 A
]11A B
;11B C
if22 
(22 
	useSqLite22 
!=22  
$str22! '
)22' (
{33 
var44 
connStr44 
=44  !
Configuration44" /
[44/ 0
$str440 P
]44P Q
;44Q R
builder55 
.55 
UseSqlServer55 (
(55( )
connStr55) 0
,550 1
opt552 5
=>556 8
opt559 <
.55< = 
EnableRetryOnFailure55= Q
(55Q R
)55R S
)55S T
;55T U
}66 
else77 
{88 
var;; 
connStr;; 
=;;  !
$str;;" 0
+;;1 2
Path<<" &
.<<& '
Combine<<' .
(<<. /
HostingEnvironment<</ A
.<<A B
ContentRootPath<<B Q
,<<Q R
$str<<S k
)<<k l
;<<l m
builder== 
.== 
	UseSqlite== %
(==% &
connStr==& -
)==- .
;==. /
}>> 
}?? 
)?? 
;?? 
varAA 
configAA 
=AA 
newAA $
ApplicationConfigurationAA 5
(AA5 6
)AA6 7
;AA7 8
ConfigurationBB 
.BB 
BindBB 
(BB 
$strBB ,
,BB, -
configBB. 4
)BB4 5
;BB5 6
servicesCC 
.CC 
AddSingletonCC !
(CC! "
configCC" (
)CC( )
;CC) *
AppEE 
.EE 
ConfigurationEE 
=EE 
configEE  &
;EE& '
servicesLL 
.LL 
AddSingletonLL !
<LL! "
IConfigurationRootLL" 4
>LL4 5
(LL5 6
ConfigurationLL6 C
)LLC D
;LLD E
servicesMM 
.MM 
AddSingletonMM !
<MM! "
IConfigurationMM" 0
>MM0 1
(MM1 2
ConfigurationMM2 ?
)MM? @
;MM@ A
servicesQQ 
.QQ 
AddCorsQQ 
(QQ 
optionsQQ $
=>QQ% '
{RR 
optionsSS 
.SS 
	AddPolicySS !
(SS! "
$strSS" .
,SS. /
builderTT 
=>TT 
builderTT &
.VV 
SetIsOriginAllowedVV +
(VV+ ,
sVV, -
=>VV- /
trueVV0 4
)VV4 5
.XX 
AllowAnyMethodXX '
(XX' (
)XX( )
.YY 
WithMethodsYY $
(YY$ %
$strYY% -
)YY- .
.ZZ 
AllowAnyHeaderZZ '
(ZZ' (
)ZZ( )
.[[ 
AllowCredentials[[ )
([[) *
)[[* +
)\\ 
;\\ 
}]] 
)]] 
;]] 
servicesjj 
.jj 
AddAuthenticationjj &
(jj& '
JwtBearerDefaultsjj' 8
.jj8 9 
AuthenticationSchemejj9 M
)jjM N
.kk 
AddJwtBearerkk 
(kk 
optionskk %
=>kk& (
{ll 
optionsmm 
.mm %
TokenValidationParametersmm 5
=mm6 7
newmm8 ;%
TokenValidationParametersmm< U
{nn 
ValidateIssueroo &
=oo' (
trueoo) -
,oo- .
ValidIssuerpp #
=pp$ %
configpp& ,
.pp, -
JwtTokenpp- 5
.pp5 6
Issuerpp6 <
,pp< =
ValidateAudienceqq (
=qq) *
trueqq+ /
,qq/ 0
ValidAudiencerr %
=rr& '
configrr( .
.rr. /
JwtTokenrr/ 7
.rr7 8
Audiencerr8 @
,rr@ A$
ValidateIssuerSigningKeyss 0
=ss1 2
truess3 7
,ss7 8
IssuerSigningKeytt (
=tt) *
newtt+ . 
SymmetricSecurityKeytt/ C
(ttC D
Encodinguu $
.uu$ %
UTF8uu% )
.uu) *
GetBytesuu* 2
(uu2 3
configuu3 9
.uu9 :
JwtTokenuu: B
.uuB C

SigningKeyuuC M
)uuM N
)uuN O
}vv 
;vv 
}xx 
)xx 
;xx 
services
ÄÄ 
.
ÄÄ 
	AddScoped
ÄÄ 
<
ÄÄ 
AlbumRepository
ÄÄ .
>
ÄÄ. /
(
ÄÄ/ 0
)
ÄÄ0 1
;
ÄÄ1 2
services
ÅÅ 
.
ÅÅ 
	AddScoped
ÅÅ 
<
ÅÅ 
ArtistRepository
ÅÅ /
>
ÅÅ/ 0
(
ÅÅ0 1
)
ÅÅ1 2
;
ÅÅ2 3
services
ÇÇ 
.
ÇÇ 
	AddScoped
ÇÇ 
<
ÇÇ 
AccountRepository
ÇÇ 0
>
ÇÇ0 1
(
ÇÇ1 2
)
ÇÇ2 3
;
ÇÇ3 4
services
ÖÖ 
.
ÖÖ 
	AddScoped
ÖÖ 
<
ÖÖ  
ApiExceptionFilter
ÖÖ 1
>
ÖÖ1 2
(
ÖÖ2 3
)
ÖÖ3 4
;
ÖÖ4 5
services
ââ 
.
ââ 
AddControllers
ââ #
(
ââ# $
)
ââ$ %
.
ãã 
AddNewtonsoftJson
ãã "
(
ãã" #
opt
ãã# &
=>
ãã' )
{
åå 
var
çç 
resolver
çç  
=
çç! "
opt
çç# &
.
çç& ' 
SerializerSettings
çç' 9
.
çç9 :
ContractResolver
çç: J
;
ççJ K
if
éé 
(
éé 
resolver
éé  
!=
éé! #
null
éé$ (
)
éé( )
{
èè 
var
êê 
res
êê 
=
êê  !
resolver
êê" *
as
êê+ -%
DefaultContractResolver
êê. E
;
êêE F
res
ëë 
.
ëë 
NamingStrategy
ëë *
=
ëë+ ,
null
ëë- 1
;
ëë1 2
}
íí 
if
îî 
(
îî  
HostingEnvironment
îî *
.
îî* +
IsDevelopment
îî+ 8
(
îî8 9
)
îî9 :
)
îî: ;
opt
ïï 
.
ïï  
SerializerSettings
ïï .
.
ïï. /

Formatting
ïï/ 9
=
ïï: ;

Newtonsoft
ïï< F
.
ïïF G
Json
ïïG K
.
ïïK L

Formatting
ïïL V
.
ïïV W
Indented
ïïW _
;
ïï_ `
}
ññ 
)
ññ 
;
ññ 
}
òò 	
public
õõ 
void
õõ 
	Configure
õõ 
(
õõ !
IApplicationBuilder
õõ 1
app
õõ2 5
,
õõ5 6!
IWebHostEnvironment
úú 
env
úú  #
,
úú# $
ILoggerFactory
ùù 
loggerFactory
ùù (
,
ùù( ) 
AlbumViewerContext
ûû 
albumContext
ûû +
,
ûû+ ,
IConfiguration
üü 
configuration
üü (
)
üü( )
{
†† 	
Log
££ 
.
££ 
Logger
££ 
=
££ 
new
££ !
LoggerConfiguration
££ 0
(
££0 1
)
££1 2
.
§§ 
WriteTo
§§ 
.
§§ 
RollingFile
§§ (
(
§§( )

pathFormat
§§) 3
:
§§3 4
$str
§§5 K
)
§§K L
.
•• 
CreateLogger
•• !
(
••! "
)
••" #
;
••# $
loggerFactory
ßß 
.
®® 

AddSerilog
®® 
(
®® 
)
®® 
;
®® 
if
´´ 
(
´´ 
env
´´ 
.
´´ 
IsDevelopment
´´ !
(
´´! "
)
´´" #
)
´´# $
{
¨¨ 
app
≠≠ 
.
≠≠ '
UseDeveloperExceptionPage
≠≠ -
(
≠≠- .
)
≠≠. /
;
≠≠/ 0
}
ÆÆ 
else
ØØ 
{
∞∞ 
app
±± 
.
±± !
UseExceptionHandler
±± 
(
±± 
errorApp
±± $
=>
±±% '
errorApp
¥¥ 
.
¥¥ 
Run
¥¥ 
(
¥¥ 
async
¥¥ 
(
¥¥ 
context
¥¥ !
)
¥¥! "
=>
¥¥# %
{
µµ 
context
∂∂ 
.
∂∂ 
Response
∂∂ 
.
∂∂ 

StatusCode
∂∂ "
=
∂∂# $
$num
∂∂% (
;
∂∂( )
context
∑∑ 
.
∑∑ 
Response
∑∑ 
.
∑∑ 
ContentType
∑∑ #
=
∑∑$ %
$str
∑∑& 1
;
∑∑1 2
await
∏∏ 
context
∏∏ 
.
∏∏ 
Response
∏∏ 
.
∏∏ 

WriteAsync
∏∏ (
(
∏∏( )
$str
∏∏) ;
)
∏∏; <
;
∏∏< =
await
ππ 
context
ππ 
.
ππ 
Response
ππ 
.
ππ 

WriteAsync
ππ (
(
ππ( )
$str
∫∫	 Z
)
∫∫Z [
;
∫∫[ \
var
ΩΩ 

error
ΩΩ 
=
ΩΩ 
context
ΩΩ 
.
ΩΩ 
Features
ΩΩ #
.
ΩΩ# $
Get
ΩΩ$ '
<
ΩΩ' (&
IExceptionHandlerFeature
ΩΩ( @
>
ΩΩ@ A
(
ΩΩA B
)
ΩΩB C
;
ΩΩC D
if
ææ 	
(
ææ
 
error
ææ 
!=
ææ 
null
ææ 
)
ææ 
{
øø 
await
¡¡ 
context
¬¬	 
.
¬¬ 
Response
¬¬ 
.
¬¬ 

WriteAsync
¬¬ $
(
¬¬$ %
$str
¬¬% 2
+
¬¬3 4
HtmlEncoder
√√ 
.
√√ 
Default
√√ #
.
√√# $
Encode
√√$ *
(
√√* +
error
√√+ 0
.
√√0 1
Error
√√1 6
.
√√6 7
Message
√√7 >
)
√√> ?
+
√√@ A
$str
ƒƒ 
)
ƒƒ 
;
ƒƒ 
}
≈≈ 
await
∆∆ 
context
∆∆ 
.
∆∆ 
Response
∆∆ 
.
∆∆ 

WriteAsync
∆∆ (
(
∆∆( )
$str
∆∆) M
)
∆∆M N
;
∆∆N O
await
«« 
context
«« 
.
«« 
Response
«« 
.
«« 

WriteAsync
«« (
(
««( )
$str
««) =
)
««= >
;
««> ?
await
»» 
context
»» 
.
»» 
Response
»» 
.
»» 

WriteAsync
»» (
(
»»( )
new
»») ,
string
»»- 3
(
»»3 4
$char
»»4 7
,
»»7 8
$num
»»9 <
)
»»< =
)
»»= >
;
»»> ?
}
…… 
)
…… 
)
…… 	
;
……	 

}
   
Console
ŒŒ 
.
ŒŒ 
	WriteLine
ŒŒ 
(
ŒŒ 
$str
ŒŒ .
+
ŒŒ/ 0
System
ŒŒ1 7
.
ŒŒ7 8
Runtime
ŒŒ8 ?
.
ŒŒ? @
InteropServices
ŒŒ@ O
.
ŒŒO P 
RuntimeInformation
ŒŒP b
.
ŒŒb c
OSDescription
ŒŒc p
)
ŒŒp q
;
ŒŒq r
string
œœ 
	useSqLite
œœ 
=
œœ 
Configuration
œœ ,
[
œœ, -
$str
œœ- =
]
œœ= >
;
œœ> ?
Console
–– 

.
––
 
	WriteLine
–– 
(
–– 
	useSqLite
–– 
==
–– !
$str
––" (
?
––) *
$str
––+ 3
:
––4 5
$str
––6 B
)
––B C
;
––C D
app
““ 
.
““ 

UseRouting
““ 
(
““ 
)
““ 
;
““ 
app
‘‘ 
.
‘‘ 
UseCors
‘‘ 
(
‘‘ 
$str
‘‘ $
)
‘‘$ %
;
‘‘% &
app
◊◊ 
.
◊◊ 
UseAuthentication
◊◊ !
(
◊◊! "
)
◊◊" #
;
◊◊# $
app
ÿÿ 
.
ÿÿ 
UseAuthorization
ÿÿ  
(
ÿÿ  !
)
ÿÿ! "
;
ÿÿ" #
app
€€ 
.
€€  
UseStatusCodePages
€€ "
(
€€" #
)
€€# $
;
€€$ %
app
›› 
.
›› 
UseDefaultFiles
›› 
(
››  
)
››  !
;
››! "
app
ﬁﬁ 
.
ﬁﬁ 
UseStaticFiles
ﬁﬁ 
(
ﬁﬁ 
)
ﬁﬁ  
;
ﬁﬁ  !
app
ÓÓ 
.
ÓÓ 
UseEndpoints
ÓÓ 
(
ÓÓ 
	endpoints
ÓÓ &
=>
ÓÓ' )
{
ÔÔ 
	endpoints
 
.
 
MapControllers
 (
(
( )
)
) *
;
* +
}
ÚÚ 
)
ÚÚ 
;
ÚÚ 
app
ıı 
.
ıı 
Run
ıı 
(
ıı 
async
ıı 
context
ıı !
=>
ıı" $
{
ˆˆ 
if
˙˙ 
(
˙˙ 
env
˙˙ 
.
˙˙ 
WebRootPath
˙˙ #
==
˙˙$ &
null
˙˙' +
)
˙˙+ ,
throw
˚˚ 
new
˚˚ '
InvalidOperationException
˚˚ 7
(
˚˚7 8
$str˚˚8 ¥
)˚˚¥ µ
;˚˚µ ∂
context
˝˝
 
.
˝˝ 
Response
˝˝ 
.
˝˝ 
ContentType
˝˝ &
=
˝˝' (
$str
˝˝) 4
;
˝˝4 5
await
˛˛ 	
context
˛˛
 
.
˛˛ 
Response
˛˛ 
.
˛˛ 
SendFileAsync
˛˛ (
(
˛˛( )
Path
˛˛) -
.
˛˛- .
Combine
˛˛. 5
(
˛˛5 6
env
˛˛6 9
.
˛˛9 :
WebRootPath
˛˛: E
,
˛˛E F
$str
˛˛G S
)
˛˛S T
)
˛˛T U
;
˛˛U V
}
ˇˇ	 

)
ˇˇ
 
;
ˇˇ %
AlbumViewerDataImporter
ÇÇ #
.
ÇÇ# $
EnsureAlbumData
ÇÇ$ 3
(
ÇÇ3 4
albumContext
ÇÇ4 @
,
ÇÇ@ A
Path
ÉÉ 
.
ÉÉ 
Combine
ÉÉ 
(
ÉÉ 
env
ÉÉ  
.
ÉÉ  !
ContentRootPath
ÉÉ! 0
,
ÉÉ0 1
$str
ÉÉ2 =
)
ÉÉ= >
)
ÉÉ> ?
;
ÉÉ? @
}
ÑÑ 	
}
ÖÖ 
}ÜÜ ⁄"
mD:\Projects\DefensePoint\whitesource-testcases-csharp\AlbumViewerVNext\src\AlbumViewerNetCore\Util\SqlUtil.cs
	namespace 	
AlbumViewerNetCore
 
{ 
public 
class 
SqlUtil 
{		 
string

 
connectionString

	 
=

 
null

  
;

  !
public 
SqlUtil	 
( 
) 
{ 
this 
. 
connectionString 
= 
$str )
+* +
Path, 0
.0 1
Combine1 8
(8 9
	Directory9 B
.B C
GetCurrentDirectoryC V
(V W
)W X
,X Y
$strZ r
)r s
+t u
$str	v É
;
É Ñ
} 
public 
void	 
CreateCommand 
( 
string "
queryString# .
). /
{ 
using 
(	 

SQLiteConnection
 

connection %
=& '
new( +
SQLiteConnection, <
(< =
connectionString= M
)M N
)N O
{ 
SQLiteCommand 
command 
= 
new 
SQLiteCommand  -
(- .
queryString. 9
,9 :

connection; E
)E F
;F G
command 
. 

Connection 
. 
Open 
( 
) 
; 
command 
. 
ExecuteNonQuery 
( 
) 
; 
} 
} 
public 
void	 
InsertTrackSafe 
( 
Track #
track$ )
)) *
{ 
string 	
insertQuery
 
= 
$str	 û
;
û ü
using 
(	 

SQLiteConnection
 

connection %
=& '
new( +
SQLiteConnection, <
(< =
connectionString= M
)M N
)N O
{   
SQLiteCommand!! 
command!! 
=!! 
new!! 
SQLiteCommand!!  -
(!!- .
insertQuery!!. 9
,!!9 :

connection!!; E
)!!E F
;!!F G
command## 
.## 

Parameters## 
.## 
AddWithValue## #
(### $
$str##$ .
,##. /
track##0 5
.##5 6
AlbumId##6 =
)##= >
;##> ?
command$$ 
.$$ 

Parameters$$ 
.$$ 
AddWithValue$$ #
($$# $
$str$$$ /
,$$/ 0
track$$1 6
.$$6 7
SongName$$7 ?
)$$? @
;$$@ A
command%% 
.%% 

Parameters%% 
.%% 
AddWithValue%% #
(%%# $
$str%%$ -
,%%- .
track%%/ 4
.%%4 5
Length%%5 ;
)%%; <
;%%< =
command&& 
.&& 

Parameters&& 
.&& 
AddWithValue&& #
(&&# $
$str&&$ ,
,&&, -
track&&. 3
.&&3 4
Bytes&&4 9
)&&9 :
;&&: ;
command'' 
.'' 

Parameters'' 
.'' 
AddWithValue'' #
(''# $
$str''$ 0
,''0 1
track''2 7
.''7 8
	UnitPrice''8 A
)''A B
;''B C
try)) 
{** 
command++ 
.++ 

Connection++ 
.++ 
Open++ 
(++ 
)++ 
;++ 
Int32,, 

rowsAffected,, 
=,, 
command,, !
.,,! "
ExecuteNonQuery,," 1
(,,1 2
),,2 3
;,,3 4
Console-- 
.-- 
	WriteLine-- 
(-- 
$str-- *
,--* +
rowsAffected--, 8
)--8 9
;--9 :
}.. 
catch// 	
(//
 
	Exception// 
ex// 
)// 
{00 
Console11 
.11 
	WriteLine11 
(11 
ex11 
.11 
Message11 !
)11! "
;11" #
}22 
}33 
}44 
}55 
}66 